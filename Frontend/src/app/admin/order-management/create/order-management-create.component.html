<div class="page-wrapper" style="min-height: 922px;">
  <div class="content">
    <div class="page-header">
      <div class="page-title">
        <h4>Thông tin đơn hàng</h4>
        <h6>VUI LÒNG CUNG CẤP CÁC THÔNG TIN VỀ ĐƠN HÀNG SẼ TẠO</h6>
      </div>
    </div>
    <div class="page-body">
        <div class="row">
          <div class="col-lg-8 col-12">
            <div class="card">
              <div class="card-body">
                <div class="ui-information-head">
                  <span class="ui-information-title font-weight-bold text-primary">Sản Phẩm</span>
                </div>
                <hr>
                <div class="ui-information-body">
                  <div class="row">
                    <div class="col-sm-6 col-12 pt-4">
                      <div class="input-group omni-product-search">
                        <div class="input-group-prepend">
                          <span class="input-group-text">
                            <svg class="svg-next-icon svg-next-icon-size-18" width="18" height="18">
                              <svg viewBox="0 0 12 12">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M7.92082 7.44942C7.95668 7.484 8.00454 7.50332 8.05435 7.50332H8.23644C8.40734 7.50332 8.57122 7.57129 8.69194 7.69226L11.3339 10.3395C11.608 10.6141 11.6078 11.0589 11.3334 11.3333C11.059 11.6077 10.6142 11.6079 10.3395 11.3338L7.69232 8.69188C7.57135 8.57116 7.50338 8.40728 7.50338 8.23638V8.05429C7.50338 8.00448 7.48406 7.95661 7.44948 7.92076C7.3787 7.84736 7.26321 7.84232 7.18318 7.90552C6.44385 8.48941 5.51187 8.83665 4.50338 8.83665C2.11004 8.83665 0.170044 6.89665 0.170044 4.50332C0.170044 2.10998 2.11004 0.169983 4.50338 0.169983C6.89671 0.169983 8.83671 2.10998 8.83671 4.50332C8.83671 5.51181 8.48947 6.44378 7.90558 7.18312C7.84238 7.26315 7.84742 7.37864 7.92082 7.44942ZM1.50338 4.50332C1.50338 6.16332 2.84338 7.50332 4.50338 7.50332C6.16338 7.50332 7.50338 6.16332 7.50338 4.50332C7.50338 2.84332 6.16338 1.50332 4.50338 1.50332C2.84338 1.50332 1.50338 2.84332 1.50338 4.50332Z"></path>
                              </svg>
                            </svg>
                          </span>
                        </div>
                        <input placeholder="Tìm kiếm sản phẩm" class="form-control" type="text" value="">
                        <div class="input-group-append">
                          <button type="button" class="btn-btn-default" (click)="searchProduct()">
                            Tìm kiếm
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row" >
                    <div class="col" *ngIf="orderProducts.length > 0">
                      <div class="table-responsive">
                        <table class="table table-striped">
                          <thead>
                            <tr>
                              <th class="min-width-300px">Sản Phẩm</th>
                              <th class="text-center">Số lượng</th>
                              <th class="text-right">Giá (đ)</th>
                              <th class="text-right">Thành tiền (đ)</th>
                              <th></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let product of orderProducts">
                              <input
                                hidden
                                type="text"
                                name="products.i"
                                formControlName="note"
                              />
                              <td class="align-middle">
                                <div class="d-flex align-items-center">
                                  <div class="mr-3 mb-3">
                                    <img
                                      [src]="'http://localhost:8096/api/v1.0/' + product.idProduct + '/product-image'"
                                      class="box-image" style="max-width: 100px;"
                                    />
                                  </div>
                                  <div class="mr-3 mb-3">
                                    <a [routerLink]="['/admin/products', product.idProduct]" class="text-primary d-block">{{product.productName}}</a>
                                  </div>
                                </div>
                              </td>
                              <td class="align-middle text-right">
                                <input
                                  type="number"
                                  class="form-control text-right"
                                  [value]="product.numberItems"
                                  style="max-width: 100px;"
                                  name="quantity"
                                  #inputElement
                                  (input)="inputQuantity(product.idProduct, inputElement)"
                                >
                              </td>
                              <td class="align-middle text-center">
                                {{ product.sellingPrice| currency:'VND' }}
                              </td>
                              <td class="align-middle text-center">{{ product.unitPrice | currency:'VND' }}</td>
                              <td class="align-middle text-right">
                                <button class="btn btn-link no-padding link-no-pding" (click)="removeProduct(product.idProduct)">
                                  <svg class="svg-next-icon svg-next-icon-size-16" width="16" height="16">
                                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                                          <path d="M18.263 16l10.07-10.07c.625-.625.625-1.636 0-2.26s-1.638-.627-2.263 0L16 13.737 5.933 3.667c-.626-.624-1.637-.624-2.262 0s-.624 1.64 0 2.264L13.74 16 3.67 26.07c-.626.625-.626 1.636 0 2.26.312.313.722.47 1.13.47s.82-.157 1.132-.47l10.07-10.068 10.068 10.07c.312.31.722.468 1.13.468s.82-.157 1.132-.47c.626-.625.626-1.636 0-2.26L18.262 16z"></path>
                                      </svg>
                                  </svg>
                                </button>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-body">
                <div class="ui-information-head">
                  <span class="ui-information-title font-weight-bold text-primary">Thanh Toán</span>
                </div>
                <hr>
                <div class="ui-information-body">
                  <div class="row">
                    <div class="col-lg-6 col-sm-6 col-12">
                      <div class="form-group">
                        <label>Ghi Chú Đơn Hàng</label>
                        <textarea
                          placeholder="Nhập ghi chú đơn hàng tại đây"
                          rows="1"
                          name="note"
                          [(ngModel)]="note"
                        >
                        </textarea>
                      </div>
                    </div>
                    <div class="col-sm-6 col-12">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="text-left">
                            <b>Số lượng sản phẩm</b>
                        </div>
                        <div class="text-right">
                            <b>{{ numberItems }}</b>
                        </div>
                      </div>
                     <div class="d-flex justify-content-between align-items-center">
                        <div class="text-left">
                            <b>Tổng tiền hàng</b>
                        </div>
                        <div class="text-right">
                          <b>{{ totalCost | currency:'VND' }}</b>
                        </div>
                      </div>
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="text-left text-primary">
                            <b>Giảm giá</b>
                        </div>
                        <div class="text-right">
                          <b>{{ 0 | currency:'VND' }}</b>
                        </div>
                      </div>
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="text-left">
                            <b>Tạm tính</b>
                        </div>
                        <div class="text-right fw-bolder">
                          <b>{{ subTotal | currency:'VND' }}</b>
                        </div>
                      </div>
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="text-left text-primary">
                            <b>Vận chuyển</b>
                        </div>
                        <div class="text-right">
                          <b>{{ 0 | currency:'VND' }}</b>
                        </div>
                      </div>
                      <div class="d-flex justify-content-between align-items-center fw-bolder">
                        <div class="text-left">
                            <b>Phải thu</b>
                        </div>
                        <div class="text-right">
                          <b>{{ totalCost | currency:'VND' }}</b>
                        </div>
                    </div>
                    </div>
                  </div>
                  <hr>
                  <div class="omni-layout-card--section d-flex justify-content-end">
                    <button id="btn-paid" class="btn btn-primary ml-3" (click)="checkout('paid')">
                      <span>Đã thanh toán</span>
                    </button>
                    <button id="btn-skip-pay" class="btn btn-primary ml-3" (click)="checkout('unpaid')">
                      <span>Thanh toán sau</span>
                    </button>
                    <div class="display-none"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="card" *ngIf="!customer">
              <div class="card mb-3">
                <div class="card-header">
                  <h5 class="card-title">Khách Hàng</h5>
                  <div class="text-right">
                    <div class="text-primary cursor-pointer">
                      <span (click)="addCustomer()" style="cursor: pointer;">Tạo mới</span>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col">
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text">
                            <svg width="14px" height="14px" viewBox="0 0 20 20">
                              <path d="M8 12a4 4 0 1 1 0-8 4 4 0 0 1 0 8m9.707 4.293l-4.82-4.82A5.968 5.968 0 0 0 14 8 6 6 0 0 0 2 8a6 6 0 0 0 6 6 5.968 5.968 0 0 0 3.473-1.113l4.82 4.82a.997.997 0 0 0 1.414 0 .999.999 0 0 0 0-1.414"></path>
                            </svg>
                          </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Tìm kiếm khách hàng" (click)="togglePopover()" >

                      </div>
                      <div class="ui-popover-dropdown ui-popover-dropdown-scroll"  *ngIf="showPopover">
                        <div class="ui-popover-body">
                          <div class="p-3 box-shadown-bottom bg-hover-info cursor-pointer" *ngFor="let customer of customers;">
                            <div class="row align-items-start no-gutters mb-2">
                              <div class="col max-width-30px">
                                <svg class="svg-next-icon svg-next-icon-size-30" width="30" height="30">
                                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
                                    <g id="Layer_2" data-name="Layer 2">
                                      <g id="Layer_1-2" data-name="Layer 1">
                                        <path xmlns="http://www.w3.org/2000/svg" fill="#3c94d1" d="M32,63.5A31.5,31.5,0,1,1,63.5,32,31.54,31.54,0,0,1,32,63.5Z">
                                        </path>
                                        <path xmlns="http://www.w3.org/2000/svg" fill="#fff" d="M32,1A31,31,0,1,1,1,32,31,31,0,0,1,32,1m0-1A32,32,0,1,0,64,32,32,32,0,0,0,32,0Z">
                                        </path>
                                        <path xmlns="http://www.w3.org/2000/svg" fill="#fff" d="M32,7.8A11.94,11.94,0,1,1,20.06,19.75,11.93,11.93,0,0,1,32,7.8Z">
                                        </path>
                                        <path xmlns="http://www.w3.org/2000/svg" fill="#fff" d="M32,59.34A28.67,28.67,0,0,1,8.11,46.52C8.23,38.59,24,34.25,32,34.25s23.77,4.34,23.89,12.26A28.67,28.67,0,0,1,32,59.34Z">
                                        </path>
                                      </g>
                                    </g>
                                  </svg>
                                </svg>
                              </div>
                              <div class="col pl-1" (click)="selectCustomer(customer)" style="cursor: pointer;">
                                <strong class="table-break-word">{{ customer.fullName }}</strong>
                                <p class="mb-0 table-break-word">{{ customer.email }}</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="dropdown-menu">
                        <div class="dropdown-header"></div>
                        <div class="dropdown-body">
                          <div class="text-center p-3">
                            <p class="font-weight-bold text-center">Không tìm thấy dữ liệu</p>
                          </div>
                        </div>
                        <div class="dropdown-footer">
                          <div class="border-top text-right p-3">
                            <div class="btn-group">
                              <button class="btn btn-default" disabled="">
                                <svg class="svg-next-icon svg-next-icon-size-14 svg-next-icon-rotate-180" width="14" height="14">
                                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.846 451.847">
                                    <g>
                                      <path d="M345.441,248.292L151.154,442.573c-12.359,12.365-32.397,12.365-44.75,0c-12.354-12.354-12.354-32.391,0-44.744   L278.318,225.92L106.409,54.017c-12.354-12.359-12.354-32.394,0-44.748c12.354-12.359,32.391-12.359,44.75,0l194.287,194.284   c6.177,6.18,9.262,14.271,9.262,22.366C354.708,234.018,351.617,242.115,345.441,248.292z"></path>
                                    </g>
                                  </svg>
                                </svg>
                              </button>
                              <button class="btn btn-default" disabled="">
                                <svg class="svg-next-icon svg-next-icon-size-14" width="14" height="14">
                                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.846 451.847">
                                    <g>
                                      <path d="M345.441,248.292L151.154,442.573c-12.359,12.365-32.397,12.365-44.75,0c-12.354-12.354-12.354-32.391,0-44.744   L278.318,225.92L106.409,54.017c-12.354-12.359-12.354-32.394,0-44.748c12.354-12.359,32.391-12.359,44.75,0l194.287,194.284   c6.177,6.18,9.262,14.271,9.262,22.366C354.708,234.018,351.617,242.115,345.441,248.292z"></path>
                                    </g>
                                  </svg>
                                </svg>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="card" *ngIf="customer">
              <div class="card omni-layout-card card-default">
                <div class="card-header omni-layout-card--header line-bottom">
                  <div class="row align-items-center">
                    <div class="col">
                      <span class="header-title fw-bolder">Thông Tin Người Mua</span>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-link no-padding" (click)="cancelCustomer()">
                        <svg class="svg-next-icon fill-gray-solid svg-next-icon-size-14" width="14" height="14">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                            <path d="M18.263 16l10.07-10.07c.625-.625.625-1.636 0-2.26s-1.638-.627-2.263 0L16 13.737 5.933 3.667c-.626-.624-1.637-.624-2.262 0s-.624 1.64 0 2.264L13.74 16 3.67 26.07c-.626.625-.626 1.636 0 2.26.312.313.722.47 1.13.47s.82-.157 1.132-.47l10.07-10.068 10.068 10.07c.312.31.722.468 1.13.468s.82-.157 1.132-.47c.626-.625.626-1.636 0-2.26L18.262 16z"></path>
                          </svg>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="card-body omni-layout-card--section">
                  <div class="omni-layout-card--section-section">
                    <div class="omni-layout-card--item-stack-cover stack-nowrap align-items-center">
                      <div class="omni-layout-card--item-stack fill">
                        <a class="mb-2 word-break" target="_blank" href="/admin/customers/1129070835">{{ customer.fullName }}</a>
                        <p class="mb-0 color-gray-solid word-break">{{ customer.email }}</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-header omni-layout-card--header">
                  <div class="row align-items-center">
                    <div class="col">
                      <span class="header-title fw-bolder">Thông tin giao hàng</span>
                    </div>
                    <div class="col-auto">
                      <div class="display-none"></div>
                      <div>
                        <span class="editaddress--block cursor-pointer">
                          <svg class="svg-next-icon text-secondary cursor-pointer svg-next-icon-size-12" width="12" height="12">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                              <g>
                                <path d="M432,0c44.182,0,80,35.817,80,80c0,18.01-5.955,34.629-16,48l-32,32L352,48l32-32C397.371,5.955,413.988,0,432,0z M32,368L0,512l144-32l296-296L328,72L32,368z M357.789,181.789l-224,224l-27.578-27.578l224-224L357.789,181.789z"></path>
                              </g>
                            </svg>
                          </svg>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-body omni-layout-card--section">
                  <div class="omni-layout-card--section-section">
                    <p class="mb-2 table-break-word">{{ customer.fullName }}</p>
                    <p class="mb-2">{{ customer.email }}</p>
                  </div>
                  <div class="omni-layout-card--section-section">
                    <p class="header-title fw-bolder">Địa Chỉ Giao Hàng</p>
                    <p class="mb-0 table-break-word">{{ customer.address }}</p>
                    <P> {{ customer.wardName }}, {{ customer.districtName }}, {{ customer.provinceName }}</P>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-12">
          <button (click)="save()" type="submit" class="btn btn-submit me-2" [disabled]="orderProducts.length==0">Lưu nháp</button>
          <a class="btn btn-cancel" (click)="previousState()">Hủy</a>
        </div>
    </div>
  </div>
</div>

